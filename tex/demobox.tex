\protected\def\demobox{\futurelet\next\demoboxA}
\def\demoboxA{\ifx*\next \expandafter\demoboxV \else \expandafter\demoboxH \fi}
\long\def\demoboxV*#1{\demoboxB{\vbox{#1\par}}}
\long\def\demoboxH#1{%
	\relax\ifmmode \mathpalette\demoboxM{#1}%
	\else \demoboxB{#1}\fi
}
\long\def\demoboxM#1#2{\demoboxB{$#1{#2}\m@th$}}
\long\def\demoboxB#1{\hbox{%
	\setbox\z@\hbox{#1}\offinterlineskip\demoboxF
	$\m@th\vcenter{\hbox{\the\ht\z@}%
	\ifdim\z@=\dp\z@\else \kern3\p@\hbox{\llap{+\ }\the\dp\z@} \fi}%
	$\kern3\p@
	\lower\dp\z@\vbox{\ialign{\hbox to5\p@{\hss##\hss}\crcr
		\hrulefill \crcr
		\vrule height\ht\z@ depth\dp\z@ \crcr
		\hrulefill \crcr
	}}\kern4\p@
	\vbox{\halign{##\crcr
		\hidewidth\the\wd\z@\hidewidth \crcr\noalign{\kern3\p@}%
		\vrule height2.5\p@ depth2.5\p@\hrulefill\vrule \crcr\noalign{\kern4\p@}
		\lower.4\p@\hbox{\dashbox{\box\z@}}%
		\crcr
	}}%
}}
\font\demoboxF=cmtt10

\protected\long\def\dashbox#1{\hbox{%
	\setbox\z@\hbox{#1}\raise-\dp\z@\vbox{%
		\offinterlineskip
		\ialign{##\crcr \xleaders\copy\dashboxH\hfil \crcr
			\rlap\dashboxA \raise\dp\z@\hbox{\xleaders\copy\dashboxH\hskip\wd\z@}\crcr
			\xleaders\copy\dashboxH\hfil \crcr
		}%
	}%
}}
\def\dashboxA{\valign{##\crcr
	\xleaders\copy\dashboxV\vfil \crcr
	\copy\z@ \crcr
	\xleaders\copy\dashboxV\vfil \crcr
}}
\newbox\dashboxH \setbox\dashboxH\hbox to4\p@{\hss \leaders\hrule\hskip2\p@ \hss}
\newbox\dashboxV \setbox\dashboxV\vbox to4\p@{\vss \leaders\vrule\vskip2\p@ \vss}

